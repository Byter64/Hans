// Code generated by Icestudio 0.10
// Sat, 18 Mar 2023 19:03:03 GMT

// Testbench template
`include "../Prozessor/Steuerung.v"
`default_nettype none
`define DUMPSTR(x) `"x.vcd`"
`timescale 10 ns / 1 ns

module main_tb
;
 
 // Simulation time: 100ns (10 * 10ns)
 parameter CLOCKSTEP = 5;
 parameter TIMESTEP = CLOCKSTEP * 2;
 parameter DECODETIME = 2;
 parameter REGISTERWRITETIME = 1;
 parameter PCWRITETIME = 1;

 // Input/Output
   reg BefehlGeladen;
   reg LoadBefehl;
   reg StoreBefehl;
   reg JALBefehl;
   reg UnbedingterSprungBefehl; //
   reg BedingterSprungBefehl; //
   reg Bedingung; //
   reg ALUFertig;
   reg DatenGeladen;
   reg DatenGespeichert;
   reg Reset;
   reg Clock;

   wire LoadBefehlSignal;
   wire DekodierSignal;
   wire ALUStartSignal;
   wire RegisterSchreibSignal;
   wire LoadDatenSignal;
   wire StoreDatenSignal;
   wire PCSignal;
   wire PCSprungSignal;

 
 // Module instance
 Steuerung strg (
   .BefehlGeladen(BefehlGeladen),
   .LoadBefehl(LoadBefehl),
   .StoreBefehl(StoreBefehl),
   .JALBefehl(JALBefehl),
   .UnbedingterSprungBefehl(UnbedingterSprungBefehl), //
   .BedingterSprungBefehl(BedingterSprungBefehl), //
   .Bedingung(Bedingung), //
   .ALUFertig(ALUFertig),
   .DatenGeladen(DatenGeladen),
   .DatenGespeichert(DatenGespeichert),
   .Reset(Reset),
   .Clock(Clock),

   .LoadBefehlSignal(LoadBefehlSignal),
   .DekodierSignal(DekodierSignal),
   .ALUStartSignal(ALUStartSignal),
   .RegisterSchreibSignal(RegisterSchreibSignal),
   .LoadDatenSignal(LoadDatenSignal),
   .StoreDatenSignal(StoreDatenSignal),
   .PCSignal(PCSignal),
   .PCSprungSignal(PCSprungSignal)
 );
 
 always begin
    #(CLOCKSTEP)
    Clock = ~Clock;
 end

 initial begin
  $dumpvars(0, main_tb);
 
  // TODO: initialize the registers here
  // e.g. value = 1;
  // e.g. #2 value = 0;
  
  //Steuerung wird initialisiert
  Clock = 1;
  #1
  Reset = 1;
  #(TIMESTEP)
  Reset = 0;

  #(TIMESTEP)
  DatenGeladen <= 1;
  //Steuerung in FETCH
  BefehlGeladen <= 1;
  assert(LoadBefehlSignal, 1, `__LINE__);
  #(TIMESTEP)
  //DECODE
  BefehlGeladen <= 0;

  assert(LoadBefehlSignal, 0, `__LINE__);
  assert(DekodierSignal, 1, `__LINE__);
  //ALU
  #(TIMESTEP)
  assert(DekodierSignal, 0, `__LINE__);
  assert(ALUStartSignal, 1, `__LINE__);
  ALUFertig <= 1;
  #(TIMESTEP)
  ALUFertig <= 0;
  //WRITEBACK
  assert(ALUStartSignal, 0, `__LINE__);
  assert(RegisterSchreibSignal, 1, `__LINE__);
  #(TIMESTEP)
  //FETCH
  assert(RegisterSchreibSignal, 0, `__LINE__);
  assert(LoadBefehlSignal, 1, `__LINE__);
  #(TIMESTEP)
  BefehlGeladen <= 1;
  ALUFertig <= 1;
  JALBefehl <= 1;
  BedingterSprungBefehl <= 1;
  #(TIMESTEP*10)


  #(TIMESTEP) $display("End of simulation");
  $finish;
 end
 
 task assert;
    input assertValue;
    input shouldValue;
    input [7:0] line;
    begin
      if (assertValue != shouldValue) begin
        $display("line %d: Value = %b, should be %b", line, assertValue, shouldValue);
        $finish;
      end
    end
 endtask

endmodule
